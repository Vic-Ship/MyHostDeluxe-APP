<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Agente - My Host Deluxe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="./js/agent-project.js"></script>
    <script src="../shared/js/api.js"></script>
    <script src="./js/init.js" defer></script>
    <script src="./js/agent-reports.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #f97316;
            --secondary-color: #fbbf24;
            --bg-dark: #13233b;
            --bg-light: #f3f4f6;
            --text-color-dark: #1f2937;
            --text-color-light: #ffffff;
            --border-color: #e5e7eb;
            --card-bg: #ffffff;
        }

        /* Estilos base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Inter", sans-serif;
        }

        body {
            font-family: "Inter", sans-serif;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }

        /* Layout principal */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--bg-dark);
            color: var(--text-color-light);
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,.1);
            display: flex;
            flex-direction: column;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,.1);
            margin-bottom: 20px;
        }

        .logo-section img {
            width: 150px;
            height: auto;
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav ul li a {
            display: flex;
            align-items: center;
            padding: 15px;
            color: var(--text-color-light);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 5px;
            transition: background-color .3s ease, background .3s ease, color .3s ease, box-shadow .3s ease;
        }

        .sidebar nav ul li a:hover,
        .sidebar nav ul li a.active {
            background: linear-gradient(to right, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-color-dark);
            box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3);
        }

        .sidebar nav ul li a i {
            margin-right: 15px;
            font-size: 1.2rem;
        }

        /* Contenido principal */
        .main-content {
            flex-grow: 1;
            padding: 30px;
            background-color: var(--bg-light);
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .header-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }

        /* Perfil de usuario */
        .user-profile {
            position: relative;
        }

        .user-profile-toggle {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: background-color .2s ease;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }

        .user-profile-toggle:hover {
            background-color: var(--border-color);
        }

        .user-profile-toggle img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }

        .user-profile-toggle #headerUserName {
            font-weight: 600;
            color: var(--text-color-dark);
            margin-right: 10px;
        }

        .user-profile-toggle .fas.fa-chevron-down {
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        .user-profile.active .user-profile-toggle .fas.fa-chevron-down {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 6px 15px rgba(0,0,0,.15);
            z-index: 10;
            width: 220px;
            padding: 15px;
            margin-top: 10px;
            text-align: center;
        }

        .user-profile.active .dropdown-menu {
            display: block;
        }

        .dropdown-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dropdown-menu li:first-child {
            margin-bottom: 5px;
        }

        .dropdown-menu li:nth-child(2) {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 10px;
            width: 80%;
        }

        #dropdownUserName {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color-dark);
        }

        #dropdownUserRole {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--primary-color);
            display: block;
            margin-top: 2px;
        }

        #logoutButton {
            background: none;
            border: none;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 600;
            background-color: #dc3545;
            color: #fff;
            cursor: pointer;
            transition: background-color .2s;
        }

        #logoutButton:hover {
            background-color: #c82333;
        }

        /* Secciones de contenido */
        .section-title {
            font-size: 1.5rem;
            font-weight: 500;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Tarjetas */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
            transition: transform .3s ease;
            text-align: center;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .card-label {
            font-size: .9rem;
            font-weight: 600;
            color: var(--text-color-dark);
        }

        /* Tarjetas de dashboard del agente */
        .card-dash {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
            transition: transform .3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-dash:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .card-text-group {
            display: flex;
            flex-direction: column;
        }

        /* Tablas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--card-bg);
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background-color: var(--bg-light);
            font-weight: 600;
            text-transform: uppercase;
            font-size: .8rem;
            color: var(--text-color-dark);
        }

        /* Badges de estado */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: .8rem;
            font-weight: 600;
            color: #000;
        }

        .status-badge.activo { background-color: #d4edda; color: #155724; }
        .status-badge.inactivo { background-color: #f8d7da; color: #721c24; }
        .status-badge.completado { background-color: #d4edda; color: #155724; }
        .status-badge.en-proceso { background-color: #fff3cd; color: #856404; }
        .status-badge.pendiente { background-color: #cce5ff; color: #004085; }
        .status-badge.suspendido { background-color: #fff3cd; color: #856404; }

        /* Badges de roles */
        .rol-administrador { background-color: #e9d8fd; color: #553c9a; }
        .rol-agente { background-color: #c6f6d5; color: #22543d; }

        /* Botones */
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: #f97316;
            color: white;
        }

        .btn-primary:hover {
            background-color: #ea580c;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: #000;
        }

        .btn-secondary:hover {
            background-color: #ebbf50;
        }

        .btn-danger {
            background-color: #dc3545;
            color: #fff;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #000;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        .btn-sm {
            padding: 6px 8px;
            font-size: 0.8rem;
            margin: 2px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 35px;
            height: 35px;
        }

        /* Utilidades */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .flex {
            display: flex;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        /* Modales */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,.3);
            width: 90%;
            max-width: 600px;
            animation: fadeIn .3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Formularios */
        .form-group {
            margin-bottom: 15px;
            position: relative;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea,
        .input-style {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #ffffff;
            color: #374151;
            font-size: 0.875rem;
            min-width: 160px;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .input-style:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(237, 172, 142, 0.801);
        }

        /* Campo de contraseña con botón de ojo */
        .password-container {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #6b7280;
        }

        .toggle-password:hover {
            color: #374151;
        }

        /* Filtros */
        .filtros-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .filtro-item {
            display: flex;
            flex-direction: column;
            min-width: 180px;
        }
        
        .filtro-item label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
            font-size: 0.875rem;
        }

        /* Estilos específicos para los filtros de clientes */
        .filtros-container-clientes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: end;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        /* Nueva estructura de filtros como en la referencia */
        .seccion-filtros {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .titulo-filtros {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .fila-filtros {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: end;
        }

        .grupo-filtro {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }

        .grupo-filtro label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
            font-size: 0.875rem;
        }

        .botones-filtros {
            display: flex;
            gap: 10px;
            margin-left: auto;
            align-items: end;
        }

        /* Toast de notificación */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: #fff;
            padding: 14px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,.25);
            font-size: 14px;
            z-index: 9999;
            transition: opacity .5s ease;
        }

        .toast.hidden {
            display: none;
        }

        /* Ficha modal */
        .ficha-agente {
            max-width: 680px;
            width: 90vw;
            max-height: 90vh;
            border-radius: 16px;
            overflow: hidden;
            background: #ffffff;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        .ficha-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 24px;
            background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%);
            color: #fff;
        }

        .avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: #ffffff33;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            border: 2px solid #ffffffaa;
        }

        .ficha-titulo { font-size: 1.4rem; font-weight: 700; margin: 0; }
        .ficha-subtitulo { font-size: 0.95rem; opacity: 0.9; margin: 0; }

        .ficha-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: #fff;
            cursor: pointer;
            margin-left: auto;
            line-height: 1;
        }

        .ficha-body {
            padding: 20px 24px;
            overflow-y: auto;
            max-height: 60vh;
        }

        .ficha-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 12px;
        }

        .ficha-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .ficha-item i {
            color: #f97316;
            width: 20px;
            text-align: center;
            margin-top: 2px;
        }

        .ficha-label {
            font-weight: 600;
            color: #4b5563;
            min-width: 130px;
        }
        .ficha-valor {
            color: #111827;
            flex: 1;
            word-break: break-word;
        }

        .ficha-footer {
            padding: 16px 24px;
            background: #f9fafb;
            display: flex;
            justify-content: flex-end;
        }

        /* Campos de servicio */
        .service-fields {
            background-color: #f8fafc;
            padding: 20px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid #f97316;
            transition: all 0.3s ease;
        }

        .service-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
        }

        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
        }

        .checkbox-item input {
            width: auto;
            margin-right: 8px;
        }

        .checkbox-item label {
            margin-bottom: 0;
            font-weight: normal;
        }

        .color-picker {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .color-input {
            width: 60px;
            height: 40px;
            padding: 0;
            border: 2px solid rgba(0, 0, 0, 0.15);
            border-radius: 4px;
            cursor: pointer;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 10px 15px;
            background: #f5f5f5;
            border: 1px dashed rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: #eaeaea;
        }

        .file-name {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }

        .required::after {
            content: " *";
            color: #ef4444;
        }

        .actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        /* Botón de guardar */
        .save-button {
            background: #f97316;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: auto;
            margin-left: auto;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .save-button:hover {
            background: #ea580c;
            transform: translateY(-2px);
        }

        .button-icon {
            width: 16px;
            height: 16px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .two-columns {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .filtros-container, .filtros-container-clientes, .fila-filtros {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filtro-item, .grupo-filtro {
                min-width: auto;
            }
            
            .botones-filtros {
                margin-left: 0;
                margin-top: 15px;
                justify-content: flex-start;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
        }
        
    
    </style>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo-section">
                <img src="/images/logo.png" alt="Logo" />
                <h3 class="text-xl font-bold mt-2">My Host Deluxe</h3>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-target="dashboard-content"><i class="fas fa-tachometer-alt"></i><span>Panel de control</span></a></li>
                    <li><a href="#" class="nav-link" data-target="projects-content"><i class="fas fa-project-diagram"></i><span>Proyectos</span></a></li>
                    <li><a href="#" class="nav-link" data-target="clients-content"><i class="fas fa-users"></i><span>Clientes</span></a></li>
                    <li><a href="#" class="nav-link" data-target="reports-content"><i class="fas fa-chart-line"></i><span>Reportes</span></a></li>
                    <li><a href="#" class="nav-link" data-target="profile-content"><i class="fas fa-user-cog"></i><span>Perfil</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <h1 class="header-title" id="mainHeaderTitle">Panel de control</h1>
                <div class="user-profile">
                    <div class="user-profile-toggle">
                        <img src="./images/perfilAgente.jpeg" alt="User" />
                        <span id="headerUserName">Agente</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>

                    <div class="dropdown-menu">
                        <ul>
                            <li><span id="dropdownUserName"></span></li>
                            <li><small><span id="dropdownUserRole"></span></small></li>
                            <li><button id="logoutButton"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button></li>
                        </ul>
                    </div>
                </div>
            </header>

            <!-- Sección del Dashboard del Agente -->
            <section class="content-section active" id="dashboard-content">
                <h2 class="section-title">Resumen de Actividad</h2>
                <div class="cards-container">
                    <div class="card-dash">
                        <i class="fas fa-clipboard-list card-icon"></i>
                        <div class="card-text-group">
                            <div class="card-value" id="activeProjects">0</div>
                            <div class="card-label">Proyectos Activos</div>
                        </div>
                    </div>
                    <div class="card-dash">
                        <i class="fas fa-hourglass-half card-icon"></i>
                        <div class="card-text-group">
                            <div class="card-value" id="pendingTasks">0</div>
                            <div class="card-label">Tareas Pendientes</div>
                        </div>
                    </div>
                    <div class="card-dash">
                        <i class="fas fa-check-circle card-icon"></i>
                        <div class="card-text-group">
                            <div class="card-value" id="completedThisMonth">0</div>
                            <div class="card-label">Completados (Mes)</div>
                        </div>
                    </div>
                    <div class="card-dash">
                        <i class="fas fa-users card-icon"></i>
                        <div class="card-text-group">
                            <div class="card-value" id="totalClients">0</div>
                            <div class="card-label">Clientes Asignados</div>
                        </div>
                    </div>
                </div>
                
                <h2 class="section-title">Tareas Urgentes y Próximas</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Proyecto</th>
                            <th>Tarea</th>
                            <th>Fecha Límite</th>
                            <th>Prioridad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="pendingTasksTableBody">
                        <tr>
                            <td colspan="5" class="text-center py-4 text-gray-500">No hay tareas pendientes.</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- En la sección de proyectos del cliente, reemplaza con: -->
<section id="projects-content" class="content-section">
    <h2 class="section-title">Proyectos y Solicitudes</h2>
    
    <!-- INTERFAZ 1: Formulario de Solicitud de Proyecto (OCULTO INICIALMENTE) -->
    <div id="formularioProyectoContainer" class="hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-700" id="tituloFormularioProyecto">Solicitar Nuevo Proyecto</h3>
                <button type="button" id="cerrarFormularioProyecto" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            
            <p class="text-gray-600 mb-6">Complete el formulario para solicitar un nuevo proyecto o servicio</p>
            
            <form id="form-proyecto" class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <!-- Sección 1: Categoría de Servicio -->
                <div class="md:col-span-2">
                    <h2 class="font-semibold text-gray-700 mb-4 text-lg">1. Servicios Solicitados</h2>
                    
                    <div class="form-group">
                        <label for="service-category" class="block font-medium text-gray-700 required">Categoría de Servicio</label>
                        <select id="service-category" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                            <option value="">Cargando categorías...</option>
                        </select>
                    </div>
                    
                    <div id="service-fields-container" class="service-fields mt-4">
                        <div class="mb-4">
                            <label for="service-select" class="block font-medium text-gray-700 required">Servicio</label>
                            <select id="service-select" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200" disabled>
                                <option value="">Primero seleccione una categoría</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button type="button" id="btn-agregar-servicio" class="btn btn-secondary" disabled>
                            <i class="fas fa-plus mr-2"></i> Agregar Servicio
                        </button>
                    </div>
                    
                    <!-- Contenedor para formularios personalizados de servicios -->
                    <div id="servicios-personalizados-container" class="space-y-6 w-full mt-6">
                        <div class="bg-gray-50 border border-gray-300 rounded-lg p-6 text-center w-full">
                            <i class="fas fa-clipboard-list text-gray-400 text-4xl mb-4"></i>
                            <p class="text-gray-600 font-medium mb-2">No hay servicios agregados</p>
                            <p class="text-gray-500 text-sm">Seleccione un servicio y haga clic en "Agregar Servicio a la Solicitud"</p>
                        </div>
                    </div>

                    <!-- Resumen de servicios -->
                    <div id="resumen-servicios" class="mt-6 bg-gray-50 border border-gray-300 rounded-lg p-6 hidden max-w-2xl mx-auto">
                        <h5 class="font-medium text-gray-700 mb-3">Resumen de Servicios Solicitados</h5>

                        <div id="lista-servicios" class="space-y-2">
                            <!-- Se agregan dinámicamente -->
                        </div>

                        <div class="mt-4 pt-4 border-t border-gray-300">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-700">Total Estimado:</span>
                                <span id="total-servicios" class="font-bold text-lg text-green-600">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sección 2: Información de Contacto (AGREGAR ESTO) -->
                <div class="md:col-span-2">
                    <h2 class="font-semibold text-gray-700 mb-4 text-lg">2. Información de Contacto</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="company-name" class="block font-medium text-gray-700 required">Nombre de la Empresa</label>
                            <input type="text" id="company-name" name="company-name" 
                                   placeholder="Personal" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                        
                        <div class="form-group">
                            <label for="client-name" class="block font-medium text-gray-700 required">Nombre del Cliente</label>
                            <div class="relative">
                                <input type="text" id="client-name" name="client-name" 
                                       placeholder="Nombre completo del cliente" 
                                       class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="agente" class="block font-medium text-gray-700 required">Agente</label>
                            <input type="text" id="agente" name="agente" 
                                   readonly
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 bg-gray-100 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                        
                        <div class="form-group">
                            <label for="email" class="block font-medium text-gray-700 required">Correo de Contacto</label>
                            <input type="email" id="email" name="email" 
                                   placeholder="cliente@empresa.com" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" class="block font-medium text-gray-700 required">Teléfono</label>
                            <input type="tel" id="phone" name="phone" 
                                   placeholder="1234-5678" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                        
                        <div class="form-group">
                            <label for="website" class="block font-medium text-gray-700">WEB / Dominio Actual (opcional)</label>
                            <input type="url" id="website" name="website" 
                                   placeholder="https://www.tudominio.com" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                        
                        <div class="form-group">
                            <label for="sector" class="block font-medium text-gray-700">Sector o Industria (opcional)</label>
                            <input type="text" id="sector" name="sector" 
                                   placeholder="Personal" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                    </div>
                </div>
                
                <!-- Sección 3: Fechas (AGREGAR ESTO) -->
                <div class="md:col-span-2">
                    <h2 class="font-semibold text-gray-700 mb-4 text-lg">3. Fechas</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="start-date" class="block font-medium text-gray-700 required">Fecha Inicio</label>
                            <input type="date" id="start-date" name="start-date" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                        
                        <div class="form-group">
                            <label for="delivery-date" class="block font-medium text-gray-700 required">Fecha Entrega</label>
                            <input type="date" id="delivery-date" name="delivery-date" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                        
                        <div class="form-group">
                            <label for="monto" class="block font-medium text-gray-700">Total Estimado</label>
                            <input type="text" id="monto" name="monto" 
                                   readonly
                                   placeholder="$0.00" 
                                   class="mt-1 block w-full rounded-md border border-gray-300 p-2 bg-gray-100 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                        </div>
                    </div>
                </div>
                
                <!-- Sección 4: Descripción del Proyecto (AGREGAR ESTO) -->
                <div class="md:col-span-2">
                    <div class="form-group">
                        <label for="project-description" class="block font-medium text-gray-700 required">Descripción del Proyecto</label>
                        <textarea id="project-description" name="project-description" 
                                  rows="4" 
                                  placeholder="Describa los detalles, objetivos y requisitos específicos del proyecto..." 
                                  class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200"></textarea>
                    </div>
                </div>
                
                <!-- Botón de Enviar -->
                <div class="md:col-span-2 mt-6 flex justify-end gap-3">
                    <button type="submit" class="btn btn-primary" id="btn-submit-proyecto">
                        <i class="fas fa-paper-plane mr-2"></i> Guardar
                    </button>
                    <button type="button" id="btnCancelarProyecto" class="btn btn-secondary">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- INTERFAZ 2: Lista de Proyectos con Filtros (VISIBLE INICIALMENTE) -->
    <div id="projectsListContainer">
        <!-- Botón Solicitar Proyecto -->
        <div class="mb-4">
            <button id="btnMostrarFormularioProyecto" class="btn btn-primary">
                <i class="fas fa-plus"></i> Crear Proyecto
            </button>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-lg">
            <!-- Sección de Filtros de Búsqueda -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Filtros de Búsqueda</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="filtro-item">
                        <label for="filtroEstadoProyecto" class="block font-medium text-gray-700 mb-2">Estado:</label>
                        <select id="filtroEstadoProyecto" class="w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                            <option value="todos">Todos</option>
                            <option value="solicitado">Solicitado</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="en-proceso">En proceso</option>
                            <option value="completado">Completado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="filtro-item">
                        <label for="filtroPrioridadProyecto" class="block font-medium text-gray-700 mb-2">Prioridad:</label>
                        <select id="filtroPrioridadProyecto" class="w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                            <option value="todos">Todas</option>
                            <option value="baja">Baja</option>
                            <option value="media">Media</option>
                            <option value="alta">Alta</option>
                        </select>
                    </div>
                    
                    <div class="filtro-item">
                        <label for="buscarProyecto" class="block font-medium text-gray-700 mb-2">Buscar:</label>
                        <input type="text" id="buscarProyecto" placeholder="Escriba nombre..." class="w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200" />
                    </div>
                </div>
            </div>

            <!-- Lista de Proyectos -->
            <div>
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Mis Proyectos</h3>
                
                <table class="data-table w-full">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Cliente</th>
                            <th>Agente</th>
                            <th>Estado</th>
                            <th>Prioridad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="projectsTableBody">
                        <tr>
                            <td colspan="6" class="text-center py-4 text-gray-500">
                                <div class="flex flex-col items-center justify-center">
                                    <i class="fas fa-spinner fa-spin text-orange-500 text-2xl mb-2"></i>
                                    <p>Cargando proyectos...</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>
            <!-- Sección de Clientes - INTERFACES SEPARADAS -->
            <section id="clients-content" class="content-section">
                
                <!-- INTERFAZ 1: Formulario de Cliente (OCULTO INICIALMENTE) -->
                <div id="formularioClienteContainer" class="hidden">
                    <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-700" id="tituloFormularioCliente">Añadir Nuevo Cliente</h3>
                            <button type="button" id="cerrarFormularioCliente" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
                        </div>
                        
                        <form id="form-cliente" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <!-- Información de la Empresa -->
                            <div class="md:col-span-2">
                                <h4 class="font-semibold text-gray-700 mb-3 border-b pb-2">Información de la Empresa</h4>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block font-medium text-gray-700 required">Nombre de la Empresa</label>
                                <input type="text" name="empresa" id="clienteEmpresa" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200" />
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700">Sector / Rubro</label>
                                <select name="rubro" id="clienteRubro" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                                    <option value="">Seleccionar sector...</option>
                                    <option value="tecnologia">Tecnología</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="consultoria">Consultoría</option>
                                    <option value="retail">Retail</option>
                                    <option value="salud">Salud</option>
                                    <option value="educacion">Educación</option>
                                    <option value="finanzas">Finanzas</option>
                                    <option value="manufactura">Manufactura</option>
                                    <option value="construccion">Construcción</option>
                                    <option value="turismo">Turismo</option>
                                    <option value="logistica">Logística</option>
                                    <option value="alimentos">Alimentos y Bebidas</option>
                                    <option value="entretenimiento">Entretenimiento</option>
                                    <option value="bienes-raices">Bienes Raíces</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                            
                            <!-- Información del Contacto -->
                            <div class="md:col-span-2 mt-4">
                                <h4 class="font-semibold text-gray-700 mb-3 border-b pb-2">Información del Contacto Principal</h4>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 required">Nombre del Contacto</label>
                                <input type="text" name="contacto" id="clienteContacto" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200" />
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 required">Email del Contacto</label>
                                <input type="email" name="email" id="clienteEmail" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200" />
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 required">Teléfono Principal</label>
                                <input type="tel" name="tel" id="clienteTelefono" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200" />
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700">Estado</label>
                                <select name="estado" id="clienteEstado" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                                    <option value="activo">Activo</option>
                                    <option value="inactivo">Inactivo</option>
                                </select>
                            </div>
                            
                            <!-- Información Adicional -->
                            <div class="md:col-span-2 mt-4">
                                <h4 class="font-semibold text-gray-700 mb-3 border-b pb-2">Información Adicional</h4>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block font-medium text-gray-700">Notas</label>
                                <textarea name="notas" id="clienteNotas" rows="3" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200"></textarea>
                            </div>
                            
                            <div class="md:col-span-2 flex justify-end gap-3 mt-4">
                                <button type="button" id="btnCancelarCliente" class="btn btn-secondary">Cancelar</button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Guardar Cliente
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- INTERFAZ 2: Lista de Clientes con Filtros (VISIBLE INICIALMENTE) -->
                <div id="clientsListContainer">
                    <!-- Botón Nuevo Cliente -->
                    <div class="mb-4">
                        <button id="btnMostrarFormularioCliente" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Nuevo Cliente
                        </button>
                    </div>

                    <!-- Contenedor unificado de Filtros y Lista -->
                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <!-- Sección de Filtros de Búsqueda -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Filtros de Búsqueda</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="filtro-item">
                                    <label for="filtroEstadoCliente" class="block font-medium text-gray-700 mb-2">Estado:</label>
                                    <select id="filtroEstadoCliente" class="input-style w-full py-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200">
                                        <option value="todos">Todos</option>
                                        <option value="activo">Activo</option>
                                        <option value="inactivo">Inactivo</option>
                                    </select>
                                </div>
                                
                                <div class="filtro-item">
                                    <label for="buscarCliente" class="block font-medium text-gray-700 mb-2">Buscar nombre:</label>
                                    <input type="text" id="buscarCliente" placeholder="Escriba nombre..." class="input-style w-full py-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 focus:outline-none transition-all duration-200" />
                                </div>
                                
                                <!-- Espacio vacío para mantener la alineación -->
                                <div class="filtro-item"></div>
                            </div>
                        </div>

                        <!-- Lista de Clientes -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Lista de Clientes</h3>
                            
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>Empresa</th>
                                        <th>Contacto</th>
                                        <th>Email</th>
                                        <th>Teléfono</th>
                                        <th>Estado</th>
                                        <th>Proyectos</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="clientsTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center py-4 text-gray-500">
                                            No hay clientes registrados.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Sección de Reportes -->
<section id="reports-content" class="content-section">
    <h2 class="section-title">Reportes de Desempeño</h2>
    
    <!-- Formulario de Reporte -->
    <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">Generar Reporte Personalizado</h3>
        <!-- IMPORTANTE: Quita el formulario o cámbialo a div -->
        <div id="form-reporte-agente" class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div>
                <label class="block font-medium text-gray-700">Tipo de Reporte</label>
                <select name="tipoReporte" required class="mt-1 block w-full rounded-md border border-gray-300 p-2">
                    <option value="tiempos">Tiempos Registrados (Horas)</option>
                    <option value="avance">Avance de Mis Proyectos</option>
                    <option value="tareas">Tareas Completadas</option>
                </select>
            </div>
            <div>
                <label class="block font-medium text-gray-700">Filtrar por Proyecto</label>
                <select name="proyecto" class="mt-1 block w-full rounded-md border border-gray-300 p-2">
                    <option value="todos">Todos</option>
                </select>
            </div>
            <div>
                <label class="block font-medium text-gray-700">Filtrar por Cliente</label>
                <select name="cliente" class="mt-1 block w-full rounded-md border border-gray-300 p-2">
                    <option value="todos">Todos</option>
                </select>
            </div>
            <!-- Botones de acción (ocupan las 3 columnas) -->
            <div class="md:col-span-3 flex justify-end gap-3 pt-3">
                <!-- IMPORTANTE: type="button" en lugar de type="submit" -->
                <button type="button" id="btnGenerarReporte" class="btn btn-primary">
                    <i class="fas fa-search"></i> Generar Vista
                </button>
                <button type="button" id="btnExportarExcel" class="btn btn-secondary">
                    <i class="fas fa-file-excel"></i> Exportar a Excel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Vista Previa del Reporte -->
    <div id="reportViewContainer" class="bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">Vista Previa del Reporte</h3>
        <div id="reportContentAgente">
            <p class="text-gray-500 text-center py-8">
                Los resultados de tu reporte aparecerán aquí al aplicar los filtros.
            </p>
        </div>
    </div>
</section>
            <!-- Sección de Perfil - UN SOLO FORMULARIO COMBINADO -->
            <section id="profile-content" class="content-section">
                
                <!-- Formulario Único que incluye Información Personal y Cambio de Contraseña -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Actualizar Información Personal y Contraseña</h3>
                    <form id="form-perfil-completo" class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                        <!-- Información Personal -->
                        <div class="md:col-span-2">
                            <h4 class="font-semibold text-gray-700 mb-3 text-lg border-b pb-2">Información Personal</h4>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block font-medium text-gray-700">Foto de Perfil</label>
                            <input type="file" name="foto" accept="image/*" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 required">Nombre</label>
                            <input type="text" name="nombre" id="perfilNombre" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 required">Apellido</label>
                            <input type="text" name="apellido" id="perfilApellido" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 required">Email de Contacto</label>
                            <input type="email" name="emailPersonal" id="perfilEmail" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700 required">Teléfono</label>
                            <input type="tel" name="tel1" id="perfilTelefono" required class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                        </div>
                        
                        <!-- Cambio de Contraseña -->
                        <div class="md:col-span-2 mt-4">
                            <h4 class="font-semibold text-gray-700 mb-3 text-lg border-b pb-2">Cambio de Contraseña</h4>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700">Contraseña Actual</label>
                            <div class="password-container">
                                <input type="password" name="currentPassword" id="currentPassword" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                                <button type="button" class="toggle-password" data-target="currentPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div></div>
                        
                        <div>
                            <label class="block font-medium text-gray-700">Nueva Contraseña (Mín. 8)</label>
                            <div class="password-container">
                                <input type="password" name="password" id="newPassword" minlength="8" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                                <button type="button" class="toggle-password" data-target="newPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block font-medium text-gray-700">Confirmar Nueva Contraseña</label>
                            <div class="password-container">
                                <input type="password" name="confirmPassword" id="confirmPassword" class="mt-1 block w-full rounded-md border border-gray-300 p-2 focus:border-black focus:outline-none" />
                                <button type="button" class="toggle-password" data-target="confirmPassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="md:col-span-2 mt-6">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Completar Tarea -->
    <div id="modalCompletarTarea" class="modal-overlay">
        <div class="modal-content" style="max-width: 520px; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,.3);">
            <div class="modal-header" style="display: flex; align-items: center; padding: 24px 28px; background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: #fff; position: relative;">
                <i class="fas fa-check-circle" style="font-size: 1.4rem; background: rgba(255,255,255,.2); padding: 10px; border-radius: 50%; margin-right: 12px;"></i>
                <h3 style="font-size: 1.5rem; font-weight: 700; margin: 0;">Completar Tarea</h3>
                <button class="modal-close-btn" data-modal="completar" style="background: rgba(255,255,255,.2); border: none; font-size: 1.5rem; color: #fff; cursor: pointer; margin-left: auto; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all .3s ease;">
                    &times;
                </button>
            </div>

            <form id="formCompletarTarea" style="padding: 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
                <input type="hidden" id="tareaCompletarId">

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-tasks" style="color: #f97316;"></i> Tarea:
                    </label>
                    <p id="tareaCompletarNombre" class="font-semibold text-gray-700" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-folder-open" style="color: #f97316;"></i> Proyecto:
                    </label>
                    <p id="tareaCompletarProyecto" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-user" style="color: #f97316;"></i> Administrador:
                    </label>
                    <p id="tareaCompletarAdministrador" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;">Administrador</p>
                </div>

                <div class="form-group" style="margin-bottom: 24px;">
                    <label for="comentarioCompletar" style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-comment-dots" style="color: #f97316;"></i> Comentarios (opcional):
                    </label>
                    <textarea id="comentarioCompletar" class="input-style w-full" rows="3" placeholder="Agregar comentarios sobre la finalización..." style="padding: 12px 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; resize: vertical; min-height: 100px; transition: all .3s ease;"></textarea>
                </div>

                <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn btn-secondary" data-modal="completar" style="background: #fbbf24; color: #000; border: 1px solid #fbbf24; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-success" style="background: #28a745; color: white; border: 1px solid #28a745; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                        Marcar como Completada
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ver Tarea -->
    <div id="modalVerTarea" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,.3);">
            <div class="modal-header" style="display: flex; align-items: center; padding: 24px 28px; background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: #fff; position: relative;">
                <i class="fas fa-tasks" style="font-size: 1.4rem; background: rgba(255,255,255,.2); padding: 10px; border-radius: 50%; margin-right: 12px;"></i>
                <h3 style="font-size: 1.5rem; font-weight: 700; margin: 0;">Detalles de la Tarea</h3>
                <button class="modal-close-btn" data-modal="ver-tarea" style="background: rgba(255,255,255,.2); border: none; font-size: 1.5rem; color: #fff; cursor: pointer; margin-left: auto; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all .3s ease;">
                    &times;
                </button>
            </div>

            <div class="modal-body" style="padding: 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-tasks" style="color: #f97316;"></i> Tarea:
                        </label>
                        <p id="detalleTareaNombre" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-folder-open" style="color: #f97316;"></i> Proyecto:
                        </label>
                        <p id="detalleTareaProyecto" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-calendar-alt" style="color: #f97316;"></i> Fecha Límite:
                        </label>
                        <p id="detalleTareaFechaLimite" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                            <i class="fas fa-flag" style="color: #f97316;"></i> Prioridad:
                        </label>
                        <p id="detalleTareaPrioridad" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-align-left" style="color: #f97316;"></i> Descripción:
                    </label>
                    <p id="detalleTareaDescripcion" class="text-gray-600 bg-gray-50 p-3 rounded-lg" style="background: #fff; padding: 14px; border: 1px solid #e5e7eb; border-radius: 12px; min-height: 80px;"></p>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-info-circle" style="color: #f97316;"></i> Estado:
                    </label>
                    <p id="detalleTareaEstado" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                </div>
            </div>

            <div class="modal-footer" style="display: flex; justify-content: flex-end; padding: 20px 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-top: 1px solid #e2e8f0;">
                <button type="button" class="btn btn-primary" data-modal="ver-tarea" style="background: #f97316; color: white; border: 1px solid #f97316; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Ver Proyecto -->
    <div id="modalVerProyecto" class="modal-overlay">
        <div class="modal-content" style="max-width: 680px; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,.3);">
            <div class="modal-header" style="display: flex; align-items: center; padding: 24px 28px; background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: #fff; position: relative;">
                <i class="fas fa-project-diagram" style="font-size: 1.4rem; background: rgba(255,255,255,.2); padding: 10px; border-radius: 50%; margin-right: 12px;"></i>
                <div>
                    <h2 class="ficha-titulo" id="fichaProyectoTitulo" style="font-size: 1.4rem; font-weight: 700; margin: 0;">Nombre del Proyecto</h2>
                    <p class="ficha-subtitulo" id="fichaProyectoSubtitulo" style="font-size: 0.95rem; opacity: 0.9; margin: 0;">Cliente: Nombre del Cliente</p>
                </div>
                <button class="modal-close-btn" data-modal="ver-proyecto" style="background: rgba(255,255,255,.2); border: none; font-size: 1.5rem; color: #fff; cursor: pointer; margin-left: auto; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all .3s ease;">
                    &times;
                </button>
            </div>

            <div class="modal-body" style="padding: 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
                <div class="ficha-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 12px;">
                    <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                        <i class="fas fa-info-circle" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Estado:</span>
                        <span class="ficha-valor" id="fichaProyectoEstado" style="color: #111827; flex: 1;">En Proceso</span>
                    </div>
                    <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                        <i class="fas fa-flag" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Prioridad:</span>
                        <span class="ficha-valor" id="fichaProyectoPrioridad" style="color: #111827; flex: 1;">Alta</span>
                    </div>
                    <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                        <i class="fas fa-calendar-alt" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Fecha Inicio:</span>
                        <span class="ficha-valor" id="fichaProyectoFechaInicio" style="color: #111827; flex: 1;">2025-10-01</span>
                    </div>
                    <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                        <i class="fas fa-calendar-check" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Fecha Entrega:</span>
                        <span class="ficha-valor" id="fichaProyectoFechaEntrega" style="color: #111827; flex: 1;">2025-10-30</span>
                    </div>
                    <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                        <i class="fas fa-dollar-sign" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Monto:</span>
                        <span class="ficha-valor" id="fichaProyectoMonto" style="color: #111827; flex: 1;">$1,200.00</span>
                    </div>
                    <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                        <i class="fas fa-user" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Agente:</span>
                        <span class="ficha-valor" id="fichaProyectoAgente" style="color: #111827; flex: 1;">Agente 1</span>
                    </div>
                    <div class="ficha-item md:col-span-2" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                        <i class="fas fa-list" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Servicios:</span>
                        <div class="ficha-valor" id="fichaProyectoServicios" style="color: #111827; flex: 1;">
                            <ul class="list-disc pl-4">
                                <li>Web Básico Anual - $1,200</li>
                            </ul>
                        </div>
                    </div>
                    <div class="ficha-item md:col-span-2" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0;">
                        <i class="fas fa-align-left" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                        <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Descripción:</span>
                        <p class="ficha-valor" id="fichaProyectoDescripcion" style="color: #111827; flex: 1;">Descripción detallada del proyecto...</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; padding: 20px 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-top: 1px solid #e2e8f0;">
                <button type="button" class="btn btn-secondary" data-modal="ver-proyecto" style="background: #fbbf24; color: #000; border: 1px solid #fbbf24; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                    Cerrar
                </button>
                <button type="button" class="btn btn-primary" id="btnEditarProyectoFicha" style="background: #f97316; color: white; border: 1px solid #f97316; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                    <i class="fas fa-edit"></i> Editar Proyecto
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Posponer Tarea - Estilo Mejorado -->
    <div id="modalPosponerTarea" class="modal-overlay">
        <div class="modal-content" style="max-width: 520px; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,.3);">
            <div class="modal-header" style="display: flex; align-items: center; padding: 24px 28px; background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: #fff; position: relative;">
                <i class="fas fa-clock" style="font-size: 1.4rem; background: rgba(255,255,255,.2); padding: 10px; border-radius: 50%; margin-right: 12px;"></i>
                <h3 style="font-size: 1.5rem; font-weight: 700; margin: 0;">Posponer Tarea</h3>
                <button class="modal-close-btn" data-modal="posponer" style="background: rgba(255,255,255,.2); border: none; font-size: 1.5rem; color: #fff; cursor: pointer; margin-left: auto; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all .3s ease;">
                    &times;
                </button>
            </div>

            <form id="formPosponerTarea" style="padding: 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
                <input type="hidden" id="tareaPosponerId">

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-tasks" style="color: #f97316;"></i> Tarea:
                    </label>
                    <p id="tareaPosponerNombre" class="font-semibold text-gray-700" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-folder-open" style="color: #f97316;"></i> Proyecto:
                    </label>
                    <p id="tareaPosponerProyecto" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="nuevaFechaLimite" style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-calendar-alt" style="color: #f97316;"></i> Nueva Fecha Límite:
                    </label>
                    <input type="date" id="nuevaFechaLimite" class="input-style w-full" required style="padding: 12px 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all .3s ease;">
                </div>

                <div class="form-group" style="margin-bottom: 24px;">
                    <label for="razonPosponer" style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                        <i class="fas fa-comment-dots" style="color: #f97316;"></i> Razón de la postergación:
                    </label>
                    <textarea id="razonPosponer" class="input-style w-full" rows="3" placeholder="Explique por qué necesita posponer esta tarea..." required style="padding: 12px 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; resize: vertical; min-height: 100px; transition: all .3s ease;"></textarea>
                </div>

                <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn btn-secondary" data-modal="posponer" style="background: #fbbf24; color: #000; border: 1px solid #fbbf24; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-warning" style="background: #ffc107; color: #000; border: 1px solid #ffc107; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                        Posponer Tarea
                    </button>
                </div>
            </form>
        </div>
    </div>
<!-- Modal Actualizar Avance -->
<div id="modalActualizarAvance" class="modal-overlay">
    <div class="modal-content" style="max-width: 520px; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,.3);">
        <div class="modal-header" style="display: flex; align-items: center; padding: 24px 28px; background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: #fff; position: relative;">
            <i class="fas fa-chart-line" style="font-size: 1.4rem; background: rgba(255,255,255,.2); padding: 10px; border-radius: 50%; margin-right: 12px;"></i>
            <h3 style="font-size: 1.5rem; font-weight: 700; margin: 0;">Actualizar Avance del Proyecto</h3>
            <button class="modal-close-btn" data-modal="actualizar-avance" style="background: rgba(255,255,255,.2); border: none; font-size: 1.5rem; color: #fff; cursor: pointer; margin-left: auto; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all .3s ease;">
                &times;
            </button>
        </div>

        <form id="formActualizarAvance" style="padding: 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
            <input type="hidden" id="proyectoAvanceId">
            
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                    <i class="fas fa-project-diagram" style="color: #f97316;"></i> Proyecto:
                </label>
                <p id="proyectoAvanceNombre" class="font-semibold text-gray-700" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                    <i class="fas fa-users" style="color: #f97316;"></i> Cliente:
                </label>
                <p id="proyectoAvanceCliente" class="text-gray-600" style="background: #fff; padding: 10px 14px; border-radius: 8px; border: 1px solid #e5e7eb;"></p>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="nuevoAvance" style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                    <i class="fas fa-percentage" style="color: #f97316;"></i> Porcentaje de Avance (%):
                </label>
                <div class="flex items-center gap-4">
                    <input type="range" id="nuevoAvance" min="0" max="100" step="5" value="0" class="flex-1" 
                        style="padding: 8px 0; accent-color: #f97316;">
                    <span id="avanceValue" class="font-semibold text-lg text-orange-600 min-w-12 text-center">0%</span>
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                    <i class="fas fa-chart-bar" style="color: #f97316;"></i> Barra de Progreso:
                </label>
                <div class="h-4 bg-gray-200 rounded-full w-full mt-2">
                    <div id="barraProgreso" class="h-4 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-full transition-all duration-500 ease-out" style="width: 0%;"></div>
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 24px;">
                <label for="comentarioAvance" style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                    <i class="fas fa-comment-dots" style="color: #f97316;"></i> Comentarios sobre el avance:
                </label>
                <textarea id="comentarioAvance" class="input-style w-full" rows="3" placeholder="Describa los avances realizados, próximos pasos o cualquier observación relevante..." 
                        style="padding: 12px 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; resize: vertical; min-height: 100px; transition: all .3s ease;"></textarea>
            </div>

            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px;">
                <button type="button" class="btn btn-secondary" data-modal="actualizar-avance" 
                        style="background: #fbbf24; color: #000; border: 1px solid #fbbf24; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary" 
                        style="background: #f97316; color: white; border: 1px solid #f97316; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                    <i class="fas fa-save mr-2"></i> Guardar Avance
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Detalles Cliente - Diseño Mejorado -->
<div id="modalDetallesCliente" class="modal-overlay">
    <div class="modal-content" style="max-width: 680px; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,.3); max-height: 85vh; display: flex; flex-direction: column;">
        <div class="modal-header" style="display: flex; align-items: center; padding: 24px 28px; background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: #fff; position: relative; flex-shrink: 0;">
            <i class="fas fa-user-tie" style="font-size: 1.4rem; background: rgba(255,255,255,.2); padding: 10px; border-radius: 50%; margin-right: 12px;"></i>
            <div>
                <h2 class="ficha-titulo" id="fichaClienteTitulo" style="font-size: 1.4rem; font-weight: 700; margin: 0;">Nombre de la Empresa</h2>
                <p class="ficha-subtitulo" id="fichaClienteSubtitulo" style="font-size: 0.95rem; opacity: 0.9; margin: 0;">Información del Cliente</p>
            </div>
            <button class="modal-close-btn" data-modal="detalles-cliente" style="background: rgba(255,255,255,.2); border: none; font-size: 1.5rem; color: #fff; cursor: pointer; margin-left: auto; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all .3s ease;">
                &times;
            </button>
        </div>

        <div class="modal-body" style="padding: 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); overflow-y: auto; flex: 1;">
            <!-- Personalización de la barra de desplazamiento -->
            <style>
                .modal-body::-webkit-scrollbar {
                    width: 8px;
                }
                .modal-body::-webkit-scrollbar-track {
                    background: #f1f1f1;
                    border-radius: 10px;
                }
                .modal-body::-webkit-scrollbar-thumb {
                    background: #f97316;
                    border-radius: 10px;
                }
                .modal-body::-webkit-scrollbar-thumb:hover {
                    background: #ea580c;
                }
            </style>

            <div class="ficha-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 12px;">
                <!-- Información de la Empresa -->
                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-building" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Empresa:</span>
                    <span class="ficha-valor" id="fichaClienteEmpresa" style="color: #111827; flex: 1;">Tech Solutions Inc.</span>
                </div>

                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-industry" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Sector:</span>
                    <span class="ficha-valor" id="fichaClienteSector" style="color: #111827; flex: 1;">Tecnología</span>
                </div>

                <!-- Información del Contacto -->
                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-user" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Contacto:</span>
                    <span class="ficha-valor" id="fichaClienteContacto" style="color: #111827; flex: 1;">Juan Pérez</span>
                </div>

                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-envelope" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Email:</span>
                    <span class="ficha-valor" id="fichaClienteEmail" style="color: #111827; flex: 1;">juan@techsolutions.com</span>
                </div>

                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-phone" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Teléfono:</span>
                    <span class="ficha-valor" id="fichaClienteTelefono" style="color: #111827; flex: 1;">+1 234 567 890</span>
                </div>

                <!-- Estado y Proyectos -->
                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-info-circle" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Estado:</span>
                    <span class="ficha-valor" id="fichaClienteEstado" style="color: #111827; flex: 1;">
                        <span class="status-badge activo">Activo</span>
                    </span>
                </div>

                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-project-diagram" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Proyectos Activos:</span>
                    <span class="ficha-valor" id="fichaClienteProyectos" style="color: #111827; flex: 1;">2</span>
                </div>

                <div class="ficha-item" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                    <i class="fas fa-calendar-alt" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Fecha Registro:</span>
                    <span class="ficha-valor" id="fichaClienteFechaRegistro" style="color: #111827; flex: 1;">2025-01-15</span>
                </div>

                <!-- Notas -->
                <div class="ficha-item md:col-span-2" style="display: flex; align-items: flex-start; gap: 10px; padding: 10px 0;">
                    <i class="fas fa-sticky-note" style="color: #f97316; width: 20px; text-align: center; margin-top: 2px;"></i>
                    <span class="ficha-label" style="font-weight: 600; color: #4b5563; min-width: 130px;">Notas:</span>
                    <p class="ficha-valor" id="fichaClienteNotas" style="color: #111827; flex: 1; background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        Cliente importante con múltiples proyectos. Muy satisfecho con los servicios anteriores.
                    </p>
                </div>
            </div>

            <!-- Proyectos del Cliente -->
            <div class="mt-6 pt-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
                    <i class="fas fa-list-check" style="color: #f97316;"></i>
                    Proyectos del Cliente
                </h3>
                <div id="fichaClienteListaProyectos" class="space-y-3">
                    <!-- Los proyectos se cargarán dinámicamente aquí -->
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        Cargando proyectos...
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; padding: 20px 28px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-top: 1px solid #e2e8f0; flex-shrink: 0;">
            <button type="button" class="btn btn-secondary" data-modal="detalles-cliente" 
                    style="background: #fbbf24; color: #000; border: 1px solid #fbbf24; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                Cerrar
            </button>
            <button type="button" class="btn btn-primary" id="btnEditarClienteFicha"
                    style="background: #f97316; color: white; border: 1px solid #f97316; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all .3s ease;">
                <i class="fas fa-edit mr-2"></i> Editar Cliente
            </button>
        </div>
    </div>
</div>
<script>
    // Función global para mostrar notificaciones
function mostrarToast(mensaje, tipo = 'info') {
    console.log('Toast:', tipo, '-', mensaje);
    
    // Eliminar toasts anteriores
    document.querySelectorAll('.toast-global').forEach(toast => {
        toast.remove();
    });
    
    const toast = document.createElement('div');
    toast.className = 'toast-global';
    toast.innerHTML = `
        <div style="position: fixed; top: 20px; right: 20px; z-index: 9999; 
                   background: ${tipo === 'success' ? '#28a745' : 
                               tipo === 'error' || tipo === 'danger' ? '#dc3545' : 
                               tipo === 'warning' ? '#ffc107' : '#17a2b8'}; 
                   color: white; padding: 12px 20px; border-radius: 4px; 
                   box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
            ${mensaje}
        </div>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, 3000);
}

// Hacerla global
window.mostrarToast = mostrarToast;
    class AgentApp {
        constructor() {
            this.currentSection = 'dashboard-content';
            this.apiBaseUrl = 'http://localhost:3001/api';
            this.user = null;
            this.isInitialized = false;
        }

        async init() {
            if (this.isInitialized) return;
            
            console.log('Inicializando aplicación del agente...');
            
            try {
                this.setupNavigation();
                this.setupLogout();
                await this.checkAuthentication();
                this.setupSectionObserver();
                this.loadInitialSection();
                
                this.isInitialized = true;
                console.log('Aplicación del agente inicializada correctamente');
            } catch (error) {
                console.error('Error al inicializar aplicación:', error);
                this.showError('Error al inicializar la aplicación');
            }
        }

        setupNavigation() {
            console.log('Configurando navegación...');
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetSection = link.getAttribute('data-target');
                    console.log('Navegando a sección:', targetSection);
                    this.showSection(targetSection);
                });
            });
        }

        setupLogout() {
            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.logout();
                });
            }
        }

        logout() {
            if (confirm('¿Está seguro de que desea cerrar sesión?')) {
                console.log('Cerrando sesión...');
                
                localStorage.removeItem('authToken');
                localStorage.removeItem('agentData');
                sessionStorage.clear();
                
                window.location.href = '../login/index.html';
            }
        }

        showSection(sectionId) {
            console.log('Mostrando sección:', sectionId);
            
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                this.currentSection = sectionId;
                
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const activeLink = document.querySelector(`[data-target="${sectionId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }

                this.updateMainTitle(sectionId);
                
                setTimeout(() => {
                    this.loadSectionData(sectionId);
                }, 100);
            } else {
                console.error('Sección no encontrada:', sectionId);
            }
        }

        updateMainTitle(sectionId) {
            const titles = {
                'dashboard-content': 'Panel de control',
                'projects-content': 'Mis Proyectos',
                'clients-content': 'Mis Clientes', 
                'reports-content': 'Mis Reportes',
                'profile-content': 'Mi Perfil'
            };
            
            const mainHeaderTitle = document.getElementById('mainHeaderTitle');
            if (mainHeaderTitle) {
                const baseTitle = titles[sectionId] || 'Panel de agente';
                const userName = this.user ? `${this.user.nombre} ${this.user.apellido}`.trim() : 'Agente';
                mainHeaderTitle.textContent = `${baseTitle} - ${userName}`;
            }
        }

        async loadSectionData(sectionId) {
            console.log('Cargando datos para sección:', sectionId);
            
            switch (sectionId) {
                case 'dashboard-content':
                    await this.initializeDashboard();
                    break;
                case 'projects-content':
                    await this.initializeProjects();
                    break;
                case 'clients-content':
                    await this.initializeClients();
                    break;
                case 'reports-content':
                    await this.initializeReports();
                    break;
                case 'profile-content':
                    await this.initializeProfile();
                    break;
            }
        }

        async initializeDashboard() {
            try {
                if (window.agentDashboard) {
                    await window.agentDashboard.loadData();
                } else if (window.initializeAgentDashboard) {
                    await window.initializeAgentDashboard();
                }
            } catch (error) {
                console.error('Error al inicializar dashboard:', error);
            }
        }

        async initializeProjects() {
            try {
                if (window.agentProjects && window.agentProjects.init) {
                    await window.agentProjects.init();
                } else if (window.initializeAgentProjects) {
                    await window.initializeAgentProjects();
                } else {
                    this.initializeProjectsFallback();
                }
            } catch (error) {
                console.error('Error al inicializar proyectos:', error);
            }
        }

        async initializeClients() {
            try {
                if (window.agentClients && window.agentClients.loadMyClients) {
                    await window.agentClients.loadMyClients();
                } else if (window.initializeAgentClients) {
                    await window.initializeAgentClients();
                }
            } catch (error) {
                console.error('Error al inicializar clientes:', error);
            }
        }

        async initializeReports() {
            try {
                if (window.agentReports && window.agentReports.loadMyReports) {
                    await window.agentReports.loadMyReports();
                } else if (window.initializeAgentReports) {
                    await window.initializeAgentReports();
                }
            } catch (error) {
                console.error('Error al inicializar reportes:', error);
            }
        }

        async initializeProfile() {
            try {
                if (window.agentProfile && window.agentProfile.loadProfile) {
                    await window.agentProfile.loadProfile();
                } else if (window.initializeAgentProfile) {
                    await window.initializeAgentProfile();
                }
            } catch (error) {
                console.error('Error al inicializar perfil:', error);
            }
        }

        initializeProjectsFallback() {
            console.log('Usando inicialización alternativa de proyectos...');
            
            const btnMostrar = document.getElementById('btnMostrarFormularioProyecto');
            const btnCancelar = document.getElementById('btnCancelarProyecto');
            const btnCerrar = document.getElementById('cerrarFormularioProyecto');
            const formularioContainer = document.getElementById('formularioProyectoContainer');
            const projectsListContainer = document.getElementById('projectsListContainer');
            
            if (btnMostrar && formularioContainer && projectsListContainer) {
                btnMostrar.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('Botón Crear Proyecto clickeado (fallback)');
                    formularioContainer.classList.remove('hidden');
                    projectsListContainer.classList.add('hidden');
                });
            }
            
            if (btnCancelar && formularioContainer && projectsListContainer) {
                btnCancelar.addEventListener('click', (e) => {
                    e.preventDefault();
                    formularioContainer.classList.add('hidden');
                    projectsListContainer.classList.remove('hidden');
                });
            }
            
            if (btnCerrar && formularioContainer && projectsListContainer) {
                btnCerrar.addEventListener('click', (e) => {
                    e.preventDefault();
                    formularioContainer.classList.add('hidden');
                    projectsListContainer.classList.remove('hidden');
                });
            }
        }

        async checkAuthentication() {
            console.log('Verificando autenticación...');
            
            const token = localStorage.getItem('authToken');
            if (!token) {
                console.error('No hay token de autenticación');
                this.redirectToLogin();
                return;
            }

            try {
                await this.loadAgentProfile();
            } catch (error) {
                console.error('Error en autenticación:', error);
                
                try {
                    const payload = this.parseJWT(token);
                    this.user = {
                        nombre: payload.nombre || 'Agente',
                        apellido: payload.apellido || '',
                        role: payload.role || 'agente'
                    };
                    
                    console.log('Usando información básica del token');
                    this.displayAgentInfo();
                } catch (e) {
                    console.error('Token inválido:', e);
                    this.redirectToLogin();
                }
            }
        }

        parseJWT(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                
                return JSON.parse(jsonPayload);
            } catch (e) {
                throw new Error('Token inválido');
            }
        }

        async loadAgentProfile() {
            try {
                console.log('Cargando perfil del agente...');
                
                const response = await window.apiCall('/agent/profile');
                
                if (response && response.success) {
                    this.user = response.data;
                    console.log('Perfil cargado:', this.user);
                    this.displayAgentInfo();
                } else {
                    throw new Error(response?.message || 'Error al cargar perfil');
                }
            } catch (error) {
                console.error('Error cargando perfil:', error);
                throw error;
            }
        }

        displayAgentInfo() {
            if (!this.user) {
                console.warn('No hay información de usuario para mostrar');
                return;
            }

            console.log('Mostrando información del agente...');
            
            const nombreCompleto = `${this.user.nombre || ''} ${this.user.apellido || ''}`.trim() || 'Agente';
            
            const headerUserName = document.getElementById('headerUserName');
            if (headerUserName) {
                headerUserName.textContent = nombreCompleto;
            }
            
            const dropdownUserName = document.getElementById('dropdownUserName');
            if (dropdownUserName) {
                dropdownUserName.textContent = nombreCompleto;
            }
            
            const dropdownUserRole = document.getElementById('dropdownUserRole');
            if (dropdownUserRole) {
                const roleDisplay = this.user.role === 'administrador' ? 'Administrador' :
                                  this.user.role === 'agente' ? 'Agente' : this.user.role;
                dropdownUserRole.textContent = roleDisplay;
            }
            
            this.setupProfileDropdown();
        }

        setupProfileDropdown() {
            const userProfileToggle = document.querySelector('.user-profile-toggle');
            const userProfile = document.querySelector('.user-profile');
            
            if (userProfileToggle && userProfile) {
                userProfileToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userProfile.classList.toggle('active');
                });
                
                document.addEventListener('click', (e) => {
                    if (!userProfile.contains(e.target)) {
                        userProfile.classList.remove('active');
                    }
                });
            }
        }

        setupSectionObserver() {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const targetId = mutation.target.id;
                        if (targetId && targetId.endsWith('-content')) {
                            if (mutation.target.classList.contains('active')) {
                                console.log('Sección activa cambiada a:', targetId);
                                this.currentSection = targetId;
                                this.loadSectionData(targetId);
                            }
                        }
                    }
                });
            });
            
            document.querySelectorAll('.content-section').forEach(section => {
                observer.observe(section, { attributes: true });
            });
        }

        loadInitialSection() {
            const dashboardSection = document.getElementById('dashboard-content');
            if (dashboardSection && !dashboardSection.classList.contains('active')) {
                this.showSection('dashboard-content');
            } else {
                this.loadSectionData(this.currentSection);
            }
        }

        redirectToLogin() {
            console.log('Redirigiendo a login...');
            localStorage.removeItem('authToken');
            setTimeout(() => {
                window.location.href = '../login/index.html';
            }, 1000);
        }

        showError(message) {
            console.error('Error:', message);
            
            if (window.mostrarToast) {
                window.mostrarToast(message, 'danger');
            } else {
                alert('Error: ' + message);
            }
        }
    }

    class AgentDashboard {
        constructor() {
            this.apiBaseUrl = window.agentApp?.apiBaseUrl || 'http://localhost:3001/api';
            this.initialized = false;
            this.dataLoaded = false;
            this.metrics = {
                activeProjects: 0,
                pendingTasks: 0,
                completedThisMonth: 0,
                totalClients: 0
            };
            this.pendingTasks = [];
        }

        async init() {
            if (this.initialized) {
                console.log('Dashboard ya está inicializado');
                return this;
            }
            
            console.log('Inicializando dashboard del agente...');
            
            try {
                this.verifyDOMElements();
                await this.setupEventListeners();
                await this.loadData();
                
                this.initialized = true;
                console.log('Dashboard inicializado correctamente');
                
                return this;
            } catch (error) {
                console.error('Error crítico al inicializar dashboard:', error);
                this.showFatalError('No se pudo inicializar el dashboard');
                throw error;
            }
        }

        verifyDOMElements() {
            console.log('Verificando elementos del DOM...');
            
            const requiredElements = {
                'activeProjects': 'Métrica: Proyectos Activos',
                'pendingTasks': 'Métrica: Tareas Pendientes',
                'completedThisMonth': 'Métrica: Completados (Mes)',
                'totalClients': 'Métrica: Clientes Asignados',
                'pendingTasksTableBody': 'Tabla: Cuerpo de tareas pendientes'
            };
            
            const missingElements = [];
            
            Object.keys(requiredElements).forEach(id => {
                const element = document.getElementById(id);
                if (!element) {
                    missingElements.push(id);
                    console.error('Elemento faltante: #' + id + ' - ' + requiredElements[id]);
                }
            });
            
            if (missingElements.length > 0) {
                throw new Error('Elementos del DOM faltantes: ' + missingElements.join(', '));
            }
        }

        async setupEventListeners() {
            console.log('Configurando event listeners...');
            
            document.addEventListener('click', (e) => {
                const button = e.target.closest('button[data-action]');
                if (button) {
                    const action = button.getAttribute('data-action');
                    const taskId = button.getAttribute('data-task-id');
                    
                    if (action && taskId) {
                        e.preventDefault();
                        this.handleTableAction(action, taskId);
                    }
                }
            });
            
            const reloadButton = document.getElementById('reloadDashboard');
            if (reloadButton) {
                reloadButton.addEventListener('click', () => this.reloadData());
            }
        }

        async loadData() {
            console.log('Cargando datos del dashboard...');
            
            try {
                this.showLoadingState();
                
                await this.loadMetrics();
                await this.loadPendingTasks();
                
                this.dataLoaded = true;
                this.hideLoadingState();
                
                console.log('Datos del dashboard cargados correctamente');
            } catch (error) {
                console.error('Error al cargar datos:', error);
                this.hideLoadingState();
                this.showError('Error al cargar datos del dashboard');
            }
        }

        async loadMetrics() {
            try {
                console.log('Cargando métricas...');
                
                const response = await window.apiCall('/agent/metrics');
                
                if (response && response.success && response.data) {
                    this.metrics = { ...response.data };
                    console.log('Métricas cargadas desde API:', this.metrics);
                    this.updateMetricsUI();
                } else {
                    throw new Error('No se pudieron cargar las métricas');
                }
            } catch (error) {
                console.error('Error en loadMetrics:', error);
                throw error;
            }
        }

        async loadPendingTasks() {
            try {
                console.log('Cargando tareas pendientes...');
                
                const response = await window.apiCall('/agent/tasks/pending');
                
                if (response && response.success && response.data) {
                    this.pendingTasks = response.data;
                    console.log('Tareas cargadas desde API:', this.pendingTasks.length + ' tareas');
                    this.updatePendingTasksUI();
                } else {
                    throw new Error('No se pudieron cargar las tareas pendientes');
                }
            } catch (error) {
                console.error('Error en loadPendingTasks:', error);
                throw error;
            }
        }

        updateMetricsUI() {
            console.log('Actualizando UI de métricas...');
            
            this.updateMetricElement('activeProjects', this.metrics.activeProjects);
            this.updateMetricElement('pendingTasks', this.metrics.pendingTasks);
            this.updateMetricElement('completedThisMonth', this.metrics.completedThisMonth);
            this.updateMetricElement('totalClients', this.metrics.totalClients);
        }

        updateMetricElement(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
            }
        }

        updatePendingTasksUI() {
            const tableBody = document.getElementById('pendingTasksTableBody');
            if (!tableBody) {
                console.error('Tabla de tareas no encontrada');
                return;
            }
            
            if (!this.pendingTasks || this.pendingTasks.length === 0) {
                tableBody.innerHTML = this.getEmptyTasksHTML();
                return;
            }
            
            tableBody.innerHTML = this.generateTasksHTML();
        }

        generateTasksHTML() {
            return this.pendingTasks.map(task => this.generateTaskRowHTML(task)).join('');
        }

        generateTaskRowHTML(task) {
            const priorityClass = this.getPriorityClass(task.prioridad);
            const formattedDate = task.fechaLimite ? this.formatDate(task.fechaLimite) : 'Sin fecha';
            
            return `
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                    <td class="py-3 px-4 border-b border-gray-200">
                        <div class="font-medium text-gray-800">${task.proyecto || 'Sin proyecto'}</div>
                    </td>
                    <td class="py-3 px-4 border-b border-gray-200">
                        <div class="text-sm text-gray-700">${task.descripcion || 'Sin descripción'}</div>
                    </td>
                    <td class="py-3 px-4 border-b border-gray-200">
                        <div class="text-sm ${this.isTaskOverdue(task) ? 'text-red-600 font-semibold' : 'text-gray-600'}">
                            ${formattedDate}
                        </div>
                    </td>
                    <td class="py-3 px-4 border-b border-gray-200">
                        <span class="status-badge ${priorityClass}">
                            ${task.prioridad || 'media'}
                        </span>
                    </td>
                    <td class="py-3 px-4 border-b border-gray-200">
                        <div class="flex space-x-2 justify-center">
                            <button data-action="complete" data-task-id="${task.id}"
                                    class="btn btn-success btn-sm" title="Completar tarea">
                                <i class="fas fa-check"></i>
                            </button>
                            <button data-action="view" data-task-id="${task.id}"
                                    class="btn btn-info btn-sm" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button data-action="postpone" data-task-id="${task.id}"
                                    class="btn btn-warning btn-sm" title="Posponer">
                                <i class="fas fa-clock"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        getEmptyTasksHTML() {
            return `
                <tr>
                    <td colspan="5" class="py-8 text-center">
                        <div class="flex flex-col items-center justify-center text-gray-500">
                            <i class="fas fa-check-circle text-4xl mb-3 text-green-400"></i>
                            <p class="text-lg font-medium mb-2">No hay tareas pendientes</p>
                            <p class="text-sm">Todas las tareas están al día.</p>
                        </div>
                    </td>
                </tr>
            `;
        }

        async handleTableAction(action, taskId) {
            console.log('Acción: ' + action + ' para tarea ' + taskId);
            
            switch (action) {
                case 'complete':
                    await this.completeTask(taskId);
                    break;
                case 'view':
                    this.viewTask(taskId);
                    break;
                case 'postpone':
                    this.postponeTask(taskId);
                    break;
            }
        }

        async completeTask(taskId) {
            try {
                if (confirm('¿Marcar esta tarea como completada?')) {
                    console.log('Completando tarea ' + taskId + '...');
                    
                    await window.apiCall('/agent/tasks/' + taskId + '/complete', { 
                        method: 'POST' 
                    });
                    
                    this.showMessage('Tarea completada exitosamente', 'success');
                    await this.reloadData();
                }
            } catch (error) {
                console.error('Error al completar tarea:', error);
                this.showError('Error al completar la tarea');
            }
        }

        viewTask(taskId) {
            console.log('Viendo tarea ' + taskId);
            
            const task = this.pendingTasks.find(t => t.id == taskId);
            
            if (task) {
                const modalVerTarea = document.getElementById('modalVerTarea');
                if (modalVerTarea) {
                    document.getElementById('detalleTareaNombre').textContent = task.descripcion || 'Sin descripción';
                    document.getElementById('detalleTareaProyecto').textContent = task.proyecto || 'Sin proyecto';
                    document.getElementById('detalleTareaFechaLimite').textContent = task.fechaLimite ? this.formatDate(task.fechaLimite) : 'Sin fecha';
                    document.getElementById('detalleTareaPrioridad').textContent = task.prioridad || 'media';
                    document.getElementById('detalleTareaDescripcion').textContent = task.descripcion || 'Sin descripción';
                    document.getElementById('detalleTareaEstado').textContent = task.estado || 'pendiente';
                    
                    modalVerTarea.classList.add('active');
                } else {
                    alert('Detalles de la tarea:\n\n' +
                          'Proyecto: ' + (task.proyecto || 'N/A') + '\n' +
                          'Descripción: ' + (task.descripcion || 'N/A') + '\n' +
                          'Fecha Límite: ' + (task.fechaLimite ? this.formatDate(task.fechaLimite) : 'N/A') + '\n' +
                          'Prioridad: ' + (task.prioridad || 'media') + '\n' +
                          'Estado: ' + (task.estado || 'pendiente'));
                }
            } else {
                this.showError('Tarea no encontrada');
            }
        }

        postponeTask(taskId) {
            console.log('Posponiendo tarea ' + taskId);
            
            const modalPosponerTarea = document.getElementById('modalPosponerTarea');
            if (modalPosponerTarea) {
                const task = this.pendingTasks.find(t => t.id == taskId);
                if (task) {
                    document.getElementById('tareaPosponerId').value = taskId;
                    document.getElementById('tareaPosponerNombre').textContent = task.descripcion || 'Sin descripción';
                    document.getElementById('tareaPosponerProyecto').textContent = task.proyecto || 'Sin proyecto';
                    
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    document.getElementById('nuevaFechaLimite').value = tomorrow.toISOString().split('T')[0];
                    
                    modalPosponerTarea.classList.add('active');
                }
            } else {
                const newDate = prompt('Ingrese la nueva fecha límite (YYYY-MM-DD):', 
                                       new Date().toISOString().split('T')[0]);
                
                if (newDate) {
                    this.showMessage('Tarea pospuesta exitosamente', 'info');
                    setTimeout(() => this.reloadData(), 1000);
                }
            }
        }

        async reloadData() {
            console.log('Recargando datos...');
            
            this.dataLoaded = false;
            await this.loadData();
        }

        formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (e) {
                return 'Fecha inválida';
            }
        }

        getPriorityClass(priority) {
            const classes = {
                'alta': 'pendiente',
                'media': 'en-proceso', 
                'baja': 'completado'
            };
            return classes[priority?.toLowerCase()] || 'en-proceso';
        }

        isTaskOverdue(task) {
            if (!task.fechaLimite) return false;
            
            try {
                const dueDate = new Date(task.fechaLimite);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                dueDate.setHours(0, 0, 0, 0);
                
                return dueDate < today;
            } catch (e) {
                return false;
            }
        }

        showLoadingState() {
            document.querySelectorAll('.card-value').forEach(el => {
                if (el.textContent === '0') {
                    el.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                }
            });
            
            const tableBody = document.getElementById('pendingTasksTableBody');
            if (tableBody) {
                tableBody.innerHTML = `
                    <tr><td colspan="5" class="py-4 text-center">
                        <div class="flex justify-center items-center space-x-2">
                            <i class="fas fa-spinner fa-spin text-orange-500"></i>
                            <span>Cargando tareas...</span>
                        </div>
                    </td></tr>
                `;
            }
        }

        hideLoadingState() {
            document.querySelectorAll('.card-value').forEach(el => {
                if (el.innerHTML.includes('fa-spinner')) {
                    const elementId = el.id;
                    const value = this.metrics[elementId] || 0;
                    el.textContent = value;
                }
            });
        }

        showMessage(message, type = 'info') {
            console.log(type.toUpperCase() + ': ' + message);
            
            if (window.mostrarToast) {
                window.mostrarToast(message, type);
            }
        }

        showError(message) {
            this.showMessage(message, 'error');
        }

        showFatalError(message) {
            console.error('ERROR FATAL: ' + message);
            
            const dashboardContent = document.getElementById('dashboard-content');
            if (dashboardContent) {
                dashboardContent.innerHTML = `
                    <div class="text-center py-12">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
                            <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Error al cargar el dashboard</h3>
                        <p class="text-gray-600 mb-4">${message}</p>
                        <button onclick="location.reload()" 
                                class="btn btn-primary">
                            <i class="fas fa-redo mr-2"></i> Reintentar
                        </button>
                    </div>
                `;
            }
        }
    }

    // Inicialización global del dashboard
    window.initializeAgentDashboard = async function() {
        console.log('Inicialización global del dashboard...');
        
        try {
            if (!window.agentApp) {
                window.agentApp = { apiBaseUrl: 'http://localhost:3001/api' };
            }
            
            if (window.agentDashboard && window.agentDashboard.initialized) {
                await window.agentDashboard.reloadData();
                return window.agentDashboard;
            }
            
            window.agentDashboard = new AgentDashboard();
            const dashboard = await window.agentDashboard.init();
            
            console.log('Dashboard listo para usar');
            return dashboard;
        } catch (error) {
            console.error('Error fatal en inicialización global:', error);
            
            const errorMessage = 'No se pudo inicializar el dashboard: ' + error.message;
            alert(errorMessage);
            
            throw error;
        }
    };

    // Módulo de Clientes (Versión Unificada)
    window.agentClients = {
        allClients: [],
        filteredClients: [],
        
        async loadMyClients() {
            console.log('Cargando clientes...');
            try {
                const response = await window.apiCall('/agent/clients');
                if (response && response.success) {
                    this.allClients = response.data || [];
                    console.log('Clientes cargados:', this.allClients.length);
                    this.updateClientsTable(this.allClients);
                }
            } catch (error) {
                console.error('Error al cargar clientes:', error);
            }
        },
        
        updateClientsTable(clients) {
            const tableBody = document.getElementById('clientsTableBody');
            if (!tableBody) return;
            
            if (!clients || clients.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4 text-gray-500">
                            No hay clientes registrados.
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            clients.forEach(client => {
                const estadoClass = client.estado === 'activo' ? 'activo' : 'inactivo';
                const estadoText = client.estado === 'activo' ? 'Activo' : 'Inactivo';
                
                html += `
                    <tr data-client-id="${client.id}">
                        <td>${client.empresa || 'Sin empresa'}</td>
                        <td>${client.contacto || 'Sin contacto'}</td>
                        <td>${client.email || 'Sin email'}</td>
                        <td>${client.telefono || 'Sin teléfono'}</td>
                        <td><span class="status-badge ${estadoClass}">${estadoText}</span></td>
                        <td>${client.proyectosActivos || 0}</td>
                        <td class="actions">
                            <button onclick="agentClients.viewClient(${client.id})" class="btn btn-info btn-sm">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="agentClients.editClient(${client.id})" class="btn btn-warning btn-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        },
        
        async viewClient(clientId) {
            console.log('Viendo cliente:', clientId);
            try {
                const response = await window.apiCall(`/agent/clients/${clientId}/details`);
                if (response && response.success) {
                    const modal = document.getElementById('modalDetallesCliente');
                    if (modal) {
                        document.getElementById('fichaClienteTitulo').textContent = 
                            response.data.empresa || 'Sin empresa';
                        document.getElementById('fichaClienteSubtitulo').textContent = 
                            response.data.contacto || 'Sin contacto';
                        document.getElementById('fichaClienteEmpresa').textContent = 
                            response.data.empresa || 'Sin empresa';
                        document.getElementById('fichaClienteSector').textContent = 
                            response.data.sector || 'No especificado';
                        document.getElementById('fichaClienteContacto').textContent = 
                            response.data.contacto || 'Sin contacto';
                        document.getElementById('fichaClienteEmail').textContent = 
                            response.data.email || 'Sin email';
                        document.getElementById('fichaClienteTelefono').textContent = 
                            response.data.telefono || 'Sin teléfono';
                        
                        const estadoElement = document.getElementById('fichaClienteEstado');
                        if (estadoElement) {
                            estadoElement.innerHTML = response.data.estado === 'activo' 
                                ? '<span class="status-badge activo">Activo</span>'
                                : '<span class="status-badge inactivo">Inactivo</span>';
                        }
                        
                        document.getElementById('fichaClienteProyectos').textContent = 
                            response.data.proyectosActivos || 0;
                        document.getElementById('fichaClienteFechaRegistro').textContent = 
                            response.data.fechaRegistro || 'No disponible';
                        document.getElementById('fichaClienteNotas').textContent = 
                            response.data.notas || 'Sin notas';
                        
                        const btnEditar = document.getElementById('btnEditarClienteFicha');
                        if (btnEditar) {
                            btnEditar.onclick = function() {
                                modal.classList.remove('active');
                                window.agentClients.editClient(clientId);
                            };
                        }
                        
                        modal.classList.add('active');
                    }
                } else {
                    alert('Error al cargar detalles del cliente');
                }
            } catch (error) {
                console.error('Error al cargar cliente:', error);
                alert('Error al cargar detalles del cliente');
            }
        },
        
        async editClient(clientId) {
            console.log('Editando cliente:', clientId);
            
            try {
                const response = await window.apiCall(`/agent/clients/${clientId}`);
                
                if (response && response.success) {
                    this.showClientForm(response.data, true);
                } else {
                    alert('Error al cargar datos del cliente');
                }
            } catch (error) {
                console.error('Error al cargar cliente:', error);
                alert('Error al cargar datos del cliente');
            }
        },
        
        showClientForm(clientData, isEdit = false) {
            const clientsListContainer = document.getElementById('clientsListContainer');
            const formularioContainer = document.getElementById('formularioClienteContainer');
            
            if (!clientsListContainer || !formularioContainer) return;
            
            clientsListContainer.classList.add('hidden');
            formularioContainer.classList.remove('hidden');
            
            const titulo = document.getElementById('tituloFormularioCliente');
            if (titulo) {
                titulo.textContent = isEdit 
                    ? `Editar Cliente: ${clientData.empresa || ''}` 
                    : 'Añadir Nuevo Cliente';
            }
            
            document.getElementById('clienteEmpresa').value = clientData.empresa || '';
            document.getElementById('clienteRubro').value = clientData.sector || 'otros';
            document.getElementById('clienteContacto').value = clientData.contacto || '';
            document.getElementById('clienteEmail').value = clientData.email || '';
            document.getElementById('clienteTelefono').value = clientData.telefono || '';
            document.getElementById('clienteEstado').value = clientData.estado || 'activo';
            document.getElementById('clienteNotas').value = clientData.notas || '';
            
            let hiddenId = document.getElementById('clienteIdHidden');
            if (!hiddenId) {
                hiddenId = document.createElement('input');
                hiddenId.type = 'hidden';
                hiddenId.id = 'clienteIdHidden';
                hiddenId.name = 'id';
                document.getElementById('form-cliente').appendChild(hiddenId);
            }
            hiddenId.value = isEdit ? (clientData.id || '') : '';
        },
        
        applyFilters() {
            if (this.allClients.length === 0) return;
            
            const filtroEstado = document.getElementById('filtroEstadoCliente');
            const buscarInput = document.getElementById('buscarCliente');
            
            const estadoFilter = filtroEstado ? filtroEstado.value : 'todos';
            const searchTerm = buscarInput ? buscarInput.value.toLowerCase().trim() : '';
            
            this.filteredClients = this.allClients.filter(client => {
                if (estadoFilter !== 'todos') {
                    if (client.estado !== estadoFilter) return false;
                }
                
                if (searchTerm) {
                    const empresa = (client.empresa || '').toLowerCase();
                    const contacto = (client.contacto || '').toLowerCase();
                    const email = (client.email || '').toLowerCase();
                    
                    if (!empresa.includes(searchTerm) && 
                        !contacto.includes(searchTerm) && 
                        !email.includes(searchTerm)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            this.updateClientsTable(this.filteredClients);
        }
    };

    window.initializeAgentClients = async function() {
        console.log('Inicializando clientes...');
        return window.agentClients;
    };

    // Módulo de Perfil
    window.agentProfile = {
        async loadProfile() {
            console.log('Cargando perfil...');
            try {
                const response = await window.apiCall('/agent/profile');
                if (response && response.success) {
                    this.updateProfileForm(response.data);
                }
            } catch (error) {
                console.error('Error al cargar perfil:', error);
            }
        },
        
        updateProfileForm(profile) {
            const setValue = (id, value) => {
                const element = document.getElementById(id);
                if (element) element.value = value || '';
            };
            
            setValue('perfilNombre', profile.nombre);
            setValue('perfilApellido', profile.apellido);
            setValue('perfilEmail', profile.emailPersonal || profile.email);
            setValue('perfilTelefono', profile.tel1);
        },
        
        async saveProfile() {
            console.log('Guardando perfil...');
            const form = document.getElementById('form-perfil-completo');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await window.apiCall('/agent/profile', {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });
                
                if (response && response.success) {
                    window.mostrarToast('Perfil actualizado correctamente', 'success');
                }
            } catch (error) {
                console.error('Error al guardar perfil:', error);
                window.mostrarToast('Error al guardar perfil', 'danger');
            }
        }
    };

    window.initializeAgentProfile = async function() {
        console.log('Inicializando perfil...');
        
        const form = document.getElementById('form-perfil-completo');
        if (form) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await window.agentProfile.saveProfile();
            });
        }
        
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const input = document.getElementById(targetId);
                if (input) {
                    const type = input.type === 'password' ? 'text' : 'password';
                    input.type = type;
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                }
            });
        });
        
        return window.agentProfile;
    };

    // Módulo de Reportes
    window.agentReports = {
        async loadMyReports() {
            console.log('Cargando reportes...');
        },
        
        async generateReport() {
            console.log('Generando reporte...');
            const form = document.getElementById('form-reporte-agente');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await window.apiCall('/agent/reports', {
                    method: 'GET',
                    params: data
                });
                
                if (response && response.success) {
                    this.displayReport(response.data);
                }
            } catch (error) {
                console.error('Error al generar reporte:', error);
                window.mostrarToast('Error al generar reporte', 'danger');
            }
        },
        
        displayReport(data) {
            const container = document.getElementById('reportContentAgente');
            if (!container) return;
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No hay datos para mostrar con los filtros seleccionados.</p>';
                return;
            }
            
            let html = '<div class="overflow-x-auto"><table class="data-table w-full">';
            html += '<thead><tr>';
            
            if (data.length > 0) {
                Object.keys(data[0]).forEach(key => {
                    html += `<th>${key}</th>`;
                });
            }
            
            html += '</tr></thead><tbody>';
            
            data.forEach(row => {
                html += '<tr>';
                Object.values(row).forEach(value => {
                    html += `<td>${value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
    };

    window.initializeAgentReports = async function() {
        console.log('Inicializando reportes...');
        
        const form = document.getElementById('form-reporte-agente');
        if (form) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await window.agentReports.generateReport();
            });
        }
        
        const exportButton = document.getElementById('btnExportarPDFAgente');
        if (exportButton) {
            exportButton.addEventListener('click', () => {
                console.log('Exportando a PDF...');
                window.mostrarToast('Funcionalidad de exportación en desarrollo', 'info');
            });
        }
        
        return window.agentReports;
    };

    // Configuración de la aplicación principal
    document.addEventListener('DOMContentLoaded', function() {
        // Configuración de modales
        document.querySelectorAll('.modal-close-btn').forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.modal-overlay').classList.remove('active');
            });
        });
        
        document.querySelectorAll('.btn-secondary[data-modal]').forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.modal-overlay').classList.remove('active');
            });
        });
        
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
        
        // Formulario para posponer tarea
        const formPosponerTarea = document.getElementById('formPosponerTarea');
        if (formPosponerTarea) {
            formPosponerTarea.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const taskId = document.getElementById('tareaPosponerId').value;
                const nuevaFecha = document.getElementById('nuevaFechaLimite').value;
                const razon = document.getElementById('razonPosponer').value;
                
                console.log('Posponiendo tarea ' + taskId + ' a fecha ' + nuevaFecha);
                
                if (window.agentDashboard) {
                    window.agentDashboard.showMessage('Tarea pospuesta exitosamente', 'success');
                }
                
                this.closest('.modal-overlay').classList.remove('active');
                
                setTimeout(() => {
                    if (window.agentDashboard) {
                        window.agentDashboard.reloadData();
                    }
                }, 500);
            });
        }
        
        // Inicializar aplicación del agente
        console.log('DOM completamente cargado - inicializando aplicación...');
        
        window.agentApp = new AgentApp();
        window.agentApp.init().catch(error => {
            console.error('Error fatal al iniciar aplicación:', error);
        });
        
        // Configuración específica del módulo de Clientes
        const btnNuevoCliente = document.getElementById('btnMostrarFormularioCliente');
        const formularioContainer = document.getElementById('formularioClienteContainer');
        const clientsListContainer = document.getElementById('clientsListContainer');
        const btnCancelarCliente = document.getElementById('btnCancelarCliente');
        const btnCerrarFormulario = document.getElementById('cerrarFormularioCliente');
        const formCliente = document.getElementById('form-cliente');
        
        // Botón Nuevo Cliente
        if (btnNuevoCliente && formularioContainer && clientsListContainer) {
            btnNuevoCliente.addEventListener('click', function(e) {
                e.preventDefault();
                window.agentClients.showClientForm({}, false);
            });
        }
        
        // Botones Cancelar/Cerrar
        if (btnCancelarCliente && formularioContainer && clientsListContainer) {
            btnCancelarCliente.addEventListener('click', function(e) {
                e.preventDefault();
                clientsListContainer.classList.remove('hidden');
                formularioContainer.classList.add('hidden');
            });
        }
        
        if (btnCerrarFormulario && formularioContainer && clientsListContainer) {
            btnCerrarFormulario.addEventListener('click', function(e) {
                e.preventDefault();
                clientsListContainer.classList.remove('hidden');
                formularioContainer.classList.add('hidden');
            });
        }
        
        // Formulario Cliente
        if (formCliente) {
            formCliente.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const data = Object.fromEntries(formData.entries());
                const clientId = data.id;
                const isEdit = !!clientId;
                
                try {
                    let response;
                    if (isEdit) {
                        response = await window.apiCall(`/agent/clients/${clientId}`, {
                            method: 'PUT',
                            body: JSON.stringify(data)
                        });
                    } else {
                        response = await window.apiCall('/agent/clients', {
                            method: 'POST',
                            body: JSON.stringify(data)
                        });
                    }
                    
                    if (response && response.success) {
                        if (window.mostrarToast) {
                            window.mostrarToast(
                                isEdit ? 'Cliente actualizado correctamente' : 'Cliente creado correctamente',
                                'success'
                            );
                        }
                        
                        if (clientsListContainer && formularioContainer) {
                            clientsListContainer.classList.remove('hidden');
                            formularioContainer.classList.add('hidden');
                        }
                        
                        if (window.agentClients && window.agentClients.loadMyClients) {
                            await window.agentClients.loadMyClients();
                        }
                    }
                } catch (error) {
                    console.error('Error al guardar cliente:', error);
                    alert('Error: ' + (error.message || 'No se pudo guardar el cliente'));
                }
            });
        }
        
        // Filtros de clientes
        const filtroEstado = document.getElementById('filtroEstadoCliente');
        const buscarInput = document.getElementById('buscarCliente');
        
        if (filtroEstado) {
            filtroEstado.addEventListener('change', function() {
                window.agentClients.applyFilters();
            });
        }
        
        if (buscarInput) {
            buscarInput.addEventListener('input', function() {
                window.agentClients.applyFilters();
            });
        }
        
        // Botón Crear Proyecto (respaldo)
        function ensureCreateProjectButtonWorks() {
            const btn = document.getElementById('btnMostrarFormularioProyecto');
            const form = document.getElementById('formularioProyectoContainer');
            const list = document.getElementById('projectsListContainer');
            
            if (btn && form && list) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    form.classList.remove('hidden');
                    list.classList.add('hidden');
                });
            }
        }
        
        ensureCreateProjectButtonWorks();
        
        // Auto-inicialización del dashboard
        const checkAndInitialize = () => {
            const dashboardSection = document.getElementById('dashboard-content');
            if (dashboardSection && dashboardSection.classList.contains('active')) {
                setTimeout(() => {
                    window.initializeAgentDashboard().catch(console.error);
                }, 300);
            }
        };
        
        checkAndInitialize();
        
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    if (mutation.target.id === 'dashboard-content') {
                        checkAndInitialize();
                    }
                }
            });
        });
        
        const dashboardSection = document.getElementById('dashboard-content');
        if (dashboardSection) {
            observer.observe(dashboardSection, { attributes: true });
        }
    });
</script>
</body>
</html>
</body>
</html>   